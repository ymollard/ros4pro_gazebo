
<!DOCTYPE HTML>
<html lang="fr" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Poppy Ergo Jr · ROS4PRO</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-language-picker/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../sawyer/" />
    
    
    <link rel="prev" href="../edo/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Tapez pour rechercher" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Qu'est-ce que c'est ?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../introduction/">
            
                <a href="../../introduction/">
            
                    
                    I. Introduction à Linux et ROS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    II. Navigation
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../navigation/turtlebot/">
            
                <a href="../../navigation/turtlebot/">
            
                    
                    Turtlebot
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    III. Manipulation
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../edo/">
            
                <a href="../edo/">
            
                    
                    E.DO
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.2" data-path="./">
            
                <a href="./">
            
                    
                    Poppy Ergo Jr
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../sawyer/">
            
                <a href="../sawyer/">
            
                    
                    Sawyer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../ur/README.md">
            
                <span>
            
                    
                    Universal Robot
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    IV. Perception
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../perception/opencv/">
            
                <a href="../../perception/opencv/">
            
                    
                    OpenCV
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../perception/keras/">
            
                <a href="../../perception/keras/">
            
                    
                    Keras
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../../perception/pytorch/">
            
                <a href="../../perception/pytorch/">
            
                    
                    Torch
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    V. Intégration
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../integration/ergo-tb-keras/">
            
                <a href="../../integration/ergo-tb-keras/">
            
                    
                    Poppy Ergo Jr + Turtlebot + Keras
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../integration/sawyer-tb-keras/">
            
                <a href="../../integration/sawyer-tb-keras/">
            
                    
                    Sawyer + Turtlebot + Keras
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../theory/">
            
                <a href="../../theory/">
            
                    
                    VI. Robotique théorique
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    VII. Simulation
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../simulation/gazebo/">
            
                <a href="../../simulation/gazebo/">
            
                    
                    Gazebo
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    Foires aux Questions
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../../faq/pi/">
            
                <a href="../../faq/pi/">
            
                    
                    FAQ robots basés sur Raspberry Pi
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Publié avec GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Poppy Ergo Jr</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="iii-robotique-de-manipulation-avec-poppy-ergo-jr">III. Robotique de manipulation avec Poppy Ergo Jr</h1>
<p>La robotique de manipulation regroupe la manipulation d&apos;objets avec des robots. Dans ce TP nous utilisons un robot opensource <a href="https://www.poppy-project.org/fr/robots/poppy-ergo-jr/" target="_blank">Poppy Ergo Jr</a> qui peut &#xEA;tre 100% imprim&#xE9; en 3D &#xE0; la maison ou &#xE0; l&apos;&#xE9;cole. </p>
<h2 id="pr&#xE9;requis">Pr&#xE9;requis</h2>
<ul>
<li>Lyc&#xE9;e et +</li>
<li>Notions de commandes dans un terminal et d&apos;adressage IP</li>
<li>Notions de Python</li>
<li>Notions de g&#xE9;om&#xE9;trie 3D</li>
<li>Le <a href="../introduction">TP d&apos;introduction</a></li>
<li>Ce TP est compatible avec la simulation si vous n&apos;avez pas de Poppy Ergo Jr : sauter directement au 2.3.bis</li>
</ul>
<h2 id="diapositives">Diapositives</h2>
<p><div class="pdf">
                                
                <div class="pdf__link"><a target="_blank" href="https://files.ros4.pro/manipulation.pdf">View PDF</a></div>
                
                                <object data="https://files.ros4.pro/manipulation.pdf" width="100%" height="565px" type="application/pdf">
                                    <embed src="https://files.ros4.pro/manipulation.pdf">
                                        <p>
                                            This browser does not support PDFs. <br>
                                            Please download the PDF to view it: <a target="_blank" href="https://files.ros4.pro/manipulation.pdf">Download PDF</a>.
                                        </p>
                                    
                                </object>
                            </div></p>
<h2 id="1-pr&#xE9;parer-le-mat&#xE9;riel-avec-un-robot-r&#xE9;el">1. Pr&#xE9;parer le mat&#xE9;riel (avec un robot r&#xE9;el)</h2>
<h3 id="11-pr&#xE9;parer-la-carte-sd">1.1. Pr&#xE9;parer la carte SD</h3>
<p>&#x1F4E5; Pour &#xE9;viter tout probl&#xE8;me li&#xE9; &#xE0; une pr&#xE9;c&#xE9;dente utilisation du robot, commencez par flasher la carte SD fournie avec l&apos;image ROS en utilisant <a href="https://github.com/ros4pro/ros4pro/blob/poppy_tb3_keras/tp/1_INTRODUCTION.md#1-images-des-cartes-sd" target="_blank">la proc&#xE9;dure vue lors de l&apos;introduction</a>. Pendant cette &#xE9;tape, assemblez votre robot en parrall&#xE8;le. </p>
<h3 id="12-assembler-poppy-ergo-jr">1.2. Assembler Poppy Ergo Jr</h3>
<p>&#x1F527; Pour assembler votre robot, veuillez suivre <a href="https://docs.poppy-project.org/fr/assembly-guides/ergo-jr/" target="_blank">le guide d&apos;assemblage</a>, en suivant les &#xE9;tapes fa&#xEE;tes pour ROS le cas &#xE9;ch&#xE9;ant ; et en comparant minutieusement chaque pi&#xE8;ce aux photos pour v&#xE9;rifier leur orientation car il est tr&#xE8;s facile d&apos;assembler ce robot &#xE0; l&apos;envers m&#xEA;me s&apos;il a au final la m&#xEA;me allure. Si votre robot est pr&#xE9;-assembl&#xE9;, recommencez &#xE0; minima toutes les configurations des moteurs qui pourraient &#xEA;tre incorrectes.</p>
<p>&#x2705; <strong>V&#xE9;rification :</strong> Pour v&#xE9;rifier que votre assemblage est correct, connectez-vous en SSH au robot (si ce n&apos;est pas d&#xE9;j&#xE0; fait) puis ex&#xE9;cutez :</p>
<pre><code>ssh pi@poppy.local      # password raspberrypi
# Effacer &#xE9;ventuellement l&apos;ancienne cl&#xE9; ECDSA si vous avez un message d&apos;erreur
roslaunch poppy_controllers control.launch
</code></pre><p>Vous devriez voir appara&#xEE;tre <code>Connection successful</code>. Si l&apos;erreur <code>&quot;Connection to the robot can&apos;t be established&quot;</code> est affich&#xE9;e, alors votre robot n&apos;a pas &#xE9;t&#xE9; mont&#xE9; correctement. La suite de ce message d&apos;erreur indique quel(s) moteur(s) pose(nt) probl&#xE8;me pour vous aider &#xE0; le r&#xE9;soudre. Fermez avec Ctrl+C puis utilisez de nouveau Poppy Configure si un moteur est mal configur&#xE9;.</p>
<p><strong>Remarque :</strong> Si vos moteurs clignotent en rouge : votre code a cr&#xE9;&#xE9; une collision et ils se sont mis en alarme. Pour d&#xE9;sactiver l&apos;alarme il faut d&#xE9;brancher et rebrancher l&apos;alimentation, ce qui fera aussi red&#xE9;marrer le robot</p>
<h2 id="2-travaux-pratiques">2. Travaux pratiques</h2>
<h3 id="21-comprendre-la-repr&#xE9;sentation-dun-robot-ros">2.1. Comprendre la repr&#xE9;sentation d&apos;un robot ROS</h3>
<p>Un robot int&#xE9;gr&#xE9; &#xE0; ROS est compos&#xE9; d&apos;au minimum :</p>
<ul>
<li>un descripteur URDF</li>
<li>un contr&#xF4;leur qui g&#xE8;re les E/S avec le robot</li>
</ul>
<h4 id="211-comprendre-le-descripteur-urdf">2.1.1. Comprendre le descripteur URDF</h4>
<p>&#x1F4BB;&#x1F4C0; Clonez le package ROS Poppy Ergo Jr Description sur votre PC, il contient le fichier de description URDF du robot :</p>
<pre><code>git clone https://github.com/poppy-project/poppy_ergo_jr_description.git
</code></pre><p>&#x1F4BB; Compilez votre workspace puis sourcez votre <code>.bashrc</code>, enfin rdv dans le dossier <code>urdf</code> de ce package, puis ex&#xE9;cutez la commande <code>urdf_to_graphiz</code> qui convertit un fichier URDF en repr&#xE9;sentation graphique dans un PDF :</p>
<pre><code>sudo apt install liburdfdom-tools
roscd poppy_ergo_jr_description/urdf
urdf_to_graphiz poppy_ergo_jr.urdf
</code></pre><p>Ouvrez le PDF obtenu puis d&#xE9;terminez :</p>
<ul>
<li>Que repr&#xE9;sentent les rectangles ?</li>
<li>Que repr&#xE9;sentent les bulles ?</li>
<li>Que repr&#xE9;sentent les fl&#xE8;ches et surtout les valeurs <code>xyz</code> et <code>rpy</code> associ&#xE9;es ?</li>
</ul>
<p><img src="https://raw.githubusercontent.com/poppy-project/poppy_ergo_jr_description/master/doc/img/rviz.png" alt="URDF de Poppy Ergo Jr"></p>
<h4 id="212-comprendre-les-es-du-contr&#xF4;leur">2.1.2. Comprendre les E/S du contr&#xF4;leur</h4>
<p>&#x1F916; Le contr&#xF4;leur se trouve d&#xE9;j&#xE0; sur le robot. Vous pouvez directement vous connecter au robot et le d&#xE9;marrer :</p>
<pre><code>ssh pi@poppy.local      # password raspberrypi
# Effacer &#xE9;ventuellement l&apos;ancienne cl&#xE9; ECDSA si vous avez un message d&apos;erreur
roslaunch poppy_controllers control.launch
</code></pre><p>&#x1F4BB; Sur votre PC, fa&#xEE;tes pointer votre <code>ROS_MASTER_URI</code> sur <code>poppy.local</code>. Rappel :</p>
<pre><code>nano ~/.bashrc      # Pour changer votre ROS_MASTER_URI
source ~/.bashrc    # Pour charger votre .bashrc et donc le nouveau master
</code></pre><h5 id="212a-topics-du-robot">2.1.2.a. Topics du robot</h5>
<p>&#x270D; Avec l&apos;utilitaire <code>rostopic</code>, lister les topics disponibles puis consultez celui qui d&#xE9;crit l&apos;&#xE9;tat courant des joints, en particulier :</p>
<ul>
<li>Quel est son nom ?</li>
<li>Quel est le type de message qu&apos;il transmet ?</li>
<li>A quelle fr&#xE9;quence (en Hertz) est-ce qu&apos;il met &#xE0; jour l&apos;&#xE9;tat des joints ?</li>
</ul>
<h5 id="212b-services-du-robot">2.1.2.b. Services du robot</h5>
<p>&#x270D; Avec les utilitaires <code>rosservice</code> et <code>rossrv</code>, listez les services disponibles puis consultez celui qui met le robot en mode <strong>compliant</strong>. En particulier :</p>
<ul>
<li>Quel est le nom de topic du service mettant le robot en compliant ?</li>
<li>Quel est le type de ce service ?</li>
<li>Consultez le d&#xE9;tail des champs. Quels sont les champs de la <strong>requ&#xEA;te</strong> de ce service ?</li>
<li>Consultez le d&#xE9;tail des champs. Quels sont les champs de la <strong>r&#xE9;ponse</strong> de ce service ?</li>
<li>Appelez ce service pour activer et d&#xE9;sactiver le mode compliant et essayez de faire bouger votre robot &#xE0; la main &#xE0; chaque fois. Que d&#xE9;duisez-vous de la signification du <strong>mode compliant</strong> ? <em>Conseil :</em> aidez-vous de l&apos;autocompl&#xE9;tion avec la touche <tab></tab></li>
</ul>
<h5 id="212c-tracer-la-courbe-des-positions-des-moteurs-en-temps-r&#xE9;el">2.1.2.c. Tracer la courbe des positions des moteurs en temps r&#xE9;el</h5>
<p>Mettez votre robot en mode compliant, d&#xE9;marrez <code>rqt_plot</code> pour tracer les positions des 6 moteurs ... bougez les moteurs &#xE0; la main et v&#xE9;rifiez que <code>rqt_plot</code> actualise la courbe en temps r&#xE9;el.</p>
<h3 id="22-cin&#xE9;matique-et-planification-avec-moveit-dans-rviz">2.2. Cin&#xE9;matique, et planification avec MoveIt dans RViz</h3>
<h4 id="221-d&#xE9;marrer-avec-moveit">2.2.1. D&#xE9;marrer avec MoveIt</h4>
<p>&#x1F4BB;&#x1F4C0; Installez MoveIt puis clonez le package ROS <strong>Poppy Ergo Jr MoveIt Configuration</strong>, il contient le code n&#xE9;cessaire pour que ce robot fonctionne avec MoveIt :</p>
<pre><code>sudo apt install ros-melodic-moveit
git clone https://github.com/poppy-project/poppy_ergo_jr_moveit_config.git
</code></pre><p>&#x1F4BB; Compilez votre workspace puis sourcez votre <code>.bashrc</code>. D&#xE9;marrez MoveIt avec <code>roslaunch</code> avec le param&#xE8;tre <code>fake_execution</code> &#xE0; false pour se connecter au vrai robot :</p>
<pre><code>roslaunch poppy_ergo_jr_moveit_config demo.launch fake_execution:=false gripper:=true
</code></pre><p>Rviz doit d&#xE9;marrer avec un Poppy Ergo Jr en visu.</p>
<p>Note : si vous devez passer en simulation &#xE0; ce moment suite &#xE0; un d&#xE9;faut mat&#xE9;riel, pensez &#xE0; changer votre <code>ROS_MASTER_URI</code> pour <code>localhost</code> puis mettre simplement <code>fake_execution</code> &#xE0; <code>true</code>.</p>
<p><img src="https://raw.githubusercontent.com/poppy-project/poppy_ergo_jr_moveit_config/36ffb295cf115a080b81aa6475ae512e88c9957a/doc/img/MoveIt.gif" alt="MoveIt avec Poppy Ergo Jr"></p>
<h4 id="222-planification">2.2.2. Planification</h4>
<p>&#x1F4BB; Dans l&apos;onglet Planning, section <strong>Query</strong> puis <strong>Planning group</strong>, s&#xE9;lectionnez le groupe <code>arm_and_finger</code>, bougez le goal (la sph&#xE8;re 3D bleue) en position et en orientation puis cliquez sur <strong>Plan</strong>.</p>
<p>&#x270D; Trois repr&#xE9;sentations 3D de robots se superposent, d&#xE9;terminez le r&#xF4;le de chacun d&apos;entre eux en testant &#xE9;galement la fonctionnalit&#xE9; <strong>Plan and Execute</strong> :</p>
<ul>
<li>Que d&#xE9;signe le robot gris parfois mobile mais lent ?</li>
<li>Que d&#xE9;signe le robot orange (fixe) ?</li>
<li>Que d&#xE9;signe le robot gris qui r&#xE9;p&#xE8;te infiniment un mouvement rapide ?</li>
<li>Dans RViz, activer l&apos;affichage du mod&#xE8;le de collision dans <code>Displays</code>, <code>Scene Robot</code>, <code>Show Robot Collision</code>, quelle est la forme de ce mod&#xE8;le utilis&#xE9; par OMPL pour simplifier le calcul des collisions ?</li>
</ul>
<h4 id="223-planning-groups">2.2.3. Planning groups</h4>
<p>&#x1F4BB;&#x270D; Testez &#xE9;galement le groupe <code>arm</code> en plus du premier <code>arm_and_finger</code> et lancez des planifications de mouvement pour tester :</p>
<ul>
<li>Quelle est la diff&#xE9;rence entre ces 2 groupes ?</li>
<li>Quel est le groupe pour lequel le goal est le plus facilement manipulable ?</li>
<li>Pourquoi ce groupe est-il plus facilement manipulable que l&apos;autre ?</li>
<li>D&#xE9;duisez-en ce que d&#xE9;signe exactement un <code>planning group</code></li>
</ul>
<h4 id="224-transformations-tf">2.2.4. Transformations <code>tf</code></h4>
<p>Nous allons visualiser et interroger l&apos;arbre des transformations nomm&#xE9; <code>tf</code></p>
<p>&#x1F4BB;&#x270D; D&#xE9;marrer MoveIt puis dans un autre terminal lancer <code>rosrun tf2_tools view_frames.py</code>. Un fichier PDF nomm&#xE9; <code>frames.pdf</code> a &#xE9;t&#xE9; cr&#xE9;&#xE9; : les <code>frames</code> (rep&#xE8;res g&#xE9;om&#xE9;triques) qu&apos;ils contient sont les m&#xEA;mes que ceux dessin&#xE9;s par Rviz en rouge-vert-bleu.</p>
<ul>
<li>Comment est nomm&#xE9; le rep&#xE8;re de base ?</li>
<li>Comment sont nomm&#xE9;s les deux effecteurs finaux possibles ?</li>
<li>La commande <code>rosrun tf2_tools echo.py frameA frameB</code> renvoie la transformation actuelle de frameB dans frameA. Modifiez cette commande pour d&#xE9;terminer quelle est la position actuelle d&apos;un des effecteurs dans le rep&#xE8;re de base. Ses coordonn&#xE9;es peuvent vous servir par la suite, pour les d&#xE9;finir comme cible &#xE0; atteindre.</li>
</ul>
<h3 id="23-ecrire-un-noeud-python-ros-pour-lergo-jr">2.3. Ecrire un noeud Python ROS pour l&apos;Ergo Jr</h3>
<h4 id="231-cr&#xE9;er-un-nouveau-package-et-un-nouveau-noeud-python">2.3.1. Cr&#xE9;er un nouveau package et un nouveau noeud Python</h4>
<p>&#x1F4BB; Nous allons cr&#xE9;er un nouveau package ROS nomm&#xE9; <strong>ros4pro_custom</strong> sur votre laptop de d&#xE9;veloppement, qui contient notre code:</p>
<pre><code>cd ~/catkin_ws/src
catkin_create_pkg ros4pro_custom          # Cette commande cr&#xE9;&#xE9; le package
mkdir -p ros4pro_custom/src                  # On cr&#xE9;&#xE9; un dossier src dans le package
touch ros4pro_custom/src/manipulate.py       # On cr&#xE9;&#xE9; un noeud Python &quot;manipulate.py&quot;
chmod +x ros4pro_custom/src/manipulate.py    # On rend ce noeud ex&#xE9;cutable pour pouvoir le lancer avec rosrun
</code></pre><p>&#x1F4BB;&#x1F40D; Bien que vous devriez avoir compris comment cr&#xE9;er un noeud ROS en Python dans les tutoriels d&apos;introduction, voici un rappel de noeud ROS minimal qui boucle toutes les secondes en Python :</p>
<pre><code>#!/usr/bin/env python

import rospy

rospy.init_node(&apos;ros4pro_custom_node&apos;)
rate = rospy.Rate(1)

while not rospy.is_shutdown():
    rospy.loginfo(&quot;Hello world from our new node!&quot;)
    rate.sleep()
</code></pre><p>&#x1F4BB; Compilez votre workspace puis sourcez votre <code>.bashrc</code>. Ex&#xE9;cutez votre noeud avec rosrun :</p>
<pre><code>cd ~/ros_ws
catkin_make
rosrun ros4pro_custom manipulate.py
</code></pre><p>Votre noeud doit afficher un message toutes les secondes, vous pouvez le tuer avec Ctrl+C. Nous allons ajouter du code petit &#xE0; petit. Attention &#xE0; l&apos;ajouter au bon endroit pour cr&#xE9;er un script coh&#xE9;rent.</p>
<h4 id="232-planifier-et-ex&#xE9;cuter-des-mouvements-avec-moveit">2.3.2. Planifier et ex&#xE9;cuter des mouvements avec MoveIt</h4>
<p>Le <code>MoveGroupCommander</code> est le commandeur de robot de MoveIt, il suffit de lui indiquer quel est le nom du groupe &#xE0; commander puis donner une cible et appeler la fonction <code>go()</code> pour l&apos;atteindre en &#xE9;vitant les obstacles. Cette cible peut &#xEA;tre dans l&apos;espace cart&#xE9;sien ou dans l&apos;espace des joints :</p>
<h5 id="232a-&#x1F40D;-cible-dans-lespace-cart&#xE9;sien">2.3.2.a. &#x1F40D; Cible dans l&apos;espace cart&#xE9;sien</h5>
<pre><code>from moveit_commander.move_group import MoveGroupCommander
commander = MoveGroupCommander(&quot;arm_and_finger&quot;)
commander.set_pose_target([0.00, 0.079, 0.220] + [0.871, -0.014, 0.079, 0.484])
commander.go()
</code></pre><p>Les coordonn&#xE9;es cart&#xE9;siennes de la cible sont les coordonn&#xE9;es de l&apos;effecteur (c&#xE0;d <code>moving_tip</code> pour le groupe <code>arm_and_finger</code> ou bien <code>fixed_tip</code> pour le groupe <code>arm</code>) dans le rep&#xE8;re <code>base_link</code>, exprim&#xE9;es sous la forme <code>x, y, z, qx, qy, qz, qw</code>.</p>
<h5 id="232b-&#x1F40D;-cible-dans-lespace-des-joints-sans-&#xE9;vitement-de-collision">2.3.2.b. &#x1F40D; Cible dans l&apos;espace des joints (sans &#xE9;vitement de collision)</h5>
<p>Il est &#xE9;galement possible de d&#xE9;finir une cible dans l&apos;espace des joints en fournissant une liste des 6 angles moteurs  dans ce cas il n&apos;y a pas d&apos;&#xE9;vitement de collision:</p>
<pre><code>commander.set_joint_value_target([0, 0, 0, 0, 0, 0])
commander.go()
</code></pre><h5 id="232c-&#x270D;-mise-en-pratique">2.3.2.c. &#x270D; Mise en pratique</h5>
<ul>
<li>A l&apos;aide des fonctions et commandes vues en 3.1.4. et 4.2.1., v&#xE9;rifiez que vous savez prendre les coordonn&#xE9;es cart&#xE9;siennes courante et les d&#xE9;finir comme cible puis l&apos;atteindre</li>
<li>A l&apos;aide des fonctions et commandes vues en 2.2.1. et 4.2.2., v&#xE9;rifiez que vous savez prendre les positions des joints courantes et les d&#xE9;finir comme cible puis l&apos;atteindre</li>
<li>A l&apos;aide du mode compliant, prendre les coordonn&#xE9;es cart&#xE9;siennes de l&apos;effecteur et et les positions des joints pour deux configurations diff&#xE9;rentes du robot A et B (e.g. effecteur vers le haut et effecteur vers le bas)</li>
<li>Fa&#xEE;tes bouger le robot infiniement entre les cibles cart&#xE9;siennes A et B, nous y ajouterons des obstacles plus tard</li>
</ul>
<h4 id="233-d&#xE9;clarer-des-obstacles">2.3.3. D&#xE9;clarer des obstacles</h4>
<p>Afin que les algorithmes de planification de trajectoire d&apos;OMPL (tels que <code>RRTConnect</code>) puissent &#xE9;viter les obstacles, il est n&#xE9;cessaire que MoveIt ait connaissance de leur position et leur forme. Il est possible d&apos;utiliser une cam&#xE9;ra de profondeur (aka cam&#xE9;ra RGB-D, mais nous n&apos;en avons pas ici) ou bien d&#xE9;clarer les objets depuis le code Python gr&#xE2;ce &#xE0; l&apos;interface <code>PlanningSceneInterface</code>.</p>
<p>&#x1F40D; Par exemple, ce code d&#xE9;clarer une boite de c&#xE9;r&#xE9;ales comme objet de collision en sp&#xE9;cifiant sa position et son orientation sous forme d&apos;objet <code>PosteStamped</code> ainsi que sa taille en m&#xE8;tres :</p>
<pre><code>from geometry_msgs.msg import PoseStamped
from moveit_commander.planning_scene_interface import PlanningSceneInterface

scene = PlanningSceneInterface()
rospy.sleep(1)

ps = PoseStamped()
ps.header.frame_id = &quot;base_link&quot;
ps.pose.position.x = 0.15
ps.pose.position.y = 0
ps.pose.position.z = 0.15
ps.pose.orientation.w = 1
scene.add_box(&quot;boite_de_cereales&quot;, ps, (0.08, 0.24, 0.3))

rospy.sleep(1)
</code></pre><p>Les coordonn&#xE9;es des objets de collision sont donn&#xE9;es sous la forme d&apos;objet <code>PoseStamped</code> incluant la <code>position</code>, l&apos;<code>orientation</code> et le rep&#xE8;re <code>frame_id</code>, et la taille est donn&#xE9;e sous forme de tuple (longueur, largeur, hauteur).</p>
<ul>
<li>Modifier l&apos;obstacle &quot;boite_de_cereales&quot; propos&#xE9; en exemple afin qu&apos;un obstacle viennent perturber le mouvement entre les deux poses de votre programme en 3.2.2. et v&#xE9;rifiez que MoveIt contourne toujours ces obstacles sans jamais les collisionner.</li>
</ul>
<p><strong>Note</strong>: Accessoirement, il est possible d&apos;attacher et de d&#xE9;tacher les objets de collision au robot, ceci permet par exemple de simuler la saisie et la d&#xE9;pose d&apos;objets physique dans RViz avec MoveIt. cf <a href="https://ros-planning.github.io/moveit_tutorials/doc/move_group_python_interface/move_group_python_interface_tutorial.html" target="_blank">la documentation MoveIt pour Python</a> ou m&#xEA;me <a href="https://github.com/ros-planning/moveit/blob/melodic-devel/moveit_commander/src/moveit_commander/planning_scene_interface.py#L56" target="_blank">le code de <code>PlanningSceneInterface</code></a></p>
<h4 id="234-enregistrer-et-rejouer-un-mouvement-de-pick-and-place">2.3.4. Enregistrer et rejouer un mouvement de pick-and-place</h4>
<p>R&#xE9;f&#xE9;rez-vous &#xE0; la documentation du <a href="https://github.com/poppy-project/poppy_controllers/#3-trajectory-record-and-playback-feature" target="_blank">Poppy Controllers</a> afin d&apos;enregistrer et de rejouer des mouvements en utilisant la compliance du robot. Fa&#xEE;tes quelques essais avec plusieurs mouvements qui s&apos;alternent pour bien comprendre le fonctionnement.</p>
<ul>
<li>Enregistrez un mouvement de pick-and-place pour attraper un cube et le d&#xE9;poser &#xE0; un autre endroit</li>
</ul>
<h4 id="24-r&#xE9;cup&#xE9;rer-les-images-de-la-cam&#xE9;ra-en-python">2.4. R&#xE9;cup&#xE9;rer les images de la cam&#xE9;ra en Python</h4>
<p>&#x1F4BB;&#x1F4C0; Avec la carte SD ROS, l&apos;image de la cam&#xE9;ra est accessible par appel d&apos;un service d&#xE9;di&#xE9;. Nous aurons besoin de r&#xE9;cup&#xE9;rer le package Poppy Controllers et le compiler d&apos;abord :</p>
<pre><code>cd ~/ros_ws/src
git clone https://github.com/poppy-project/poppy_controllers.git    # Nous aurons besoin de ce package
cd ~/ros_ws/
catkin_make
source ~/.bashrc
</code></pre><p>&#x1F40D; Testez ce code pour v&#xE9;rifier que vous pouvez r&#xE9;cup&#xE9;rer l&apos;image en Python via le service ROS <code>/get_image</code> fourni par le contr&#xF4;leur.</p>
<pre><code>import cv2
from poppy_controllers.srv import GetImage
from cv_bridge import CvBridge

get_image = rospy.ServiceProxy(&quot;get_image&quot;, GetImage)
response = get_image()
bridge = CvBridge()
image = bridge.imgmsg_to_cv2(response.image)
cv2.imshow(&quot;Poppy camera&quot;, image)
cv2.waitKey(200)
</code></pre><p>Cette image peut ensuite &#xEA;tre trait&#xE9;e par un r&#xE9;seau de neurones, une fonction OpenCV, etc ... </p>
<h2 id="documentation">Documentation</h2>
<ul>
<li><a href="https://ros-planning.github.io/moveit_tutorials/" target="_blank">Tutoriaux de MoveIt</a></li>
<li><a href="https://github.com/ros-planning/moveit/tree/master/moveit_commander/src/moveit_commander" target="_blank">Code du MoveIt Commander Python</a></li>
<li><a href="http://docs.ros.org/melodic/api/moveit_python/html/namespacemoveit__python.html" target="_blank">Documentation de l&#x2019;API MoveIt en Python</a></li>
<li><a href="https://docs.poppy-project.org/fr/assembly-guides/ergo-jr/" target="_blank">Documentation de Poppy Ergo Jr</a></li>
</ul>
<p><div id="page-footer" class="localized-footer"><hr><p><a href="https://creativecommons.org/licenses/by-nc-sa/3.0/fr/" target="_blank"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/ce/Cc-by-nc-sa_euro_icon.svg/120px-Cc-by-nc-sa_euro_icon.svg.png" alt="CC-BY-NC-SA"></a></p>
<h4 id="&#x1F4DA;-auteurs">&#x1F4DA; Auteurs</h4>
<p>Jessica Colombel (<a href="http://inria.fr/" target="_blank">Inria</a>), R&#xE9;mi Fabre (<a href="https://robotics.catie.fr/" target="_blank">CATIE</a>), Jean-Baptiste Horel (<a href="https://robotics.catie.fr/" target="_blank">CATIE</a>), Yoan Mollard (<a href="https://robot-enseirb-matmeca.fr/" target="_blank">Bordeaux INP</a>), Alexandre P&#xE9;r&#xE9; (<a href="https://flowers.inria.fr" target="_blank">Inria</a>), Steve N&apos;Guyen (<a href="https://www.labri.fr/" target="_blank">LaBRI</a>) .</p>
<h4 id="&#x1F4AC;-besoin-daide-">&#x1F4AC; Besoin d&apos;aide ?</h4>
<p>Posez votre question sur le <a href="https://discourse.ros.org/c/local/france/48" target="_blank">forum francophone des utilisateurs de ROS</a>.</p>
<p>&#x1F4C5;  Derni&#xE8;re mise &#xE0; jour : 2021-01-03T19:14:24+01:00</p>
<!-- Default to night theme -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" defer>
$("div").first().addClass("color-theme-2");
</script></div></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../edo/" class="navigation navigation-prev " aria-label="Previous page: E.DO">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../sawyer/" class="navigation navigation-next " aria-label="Next page: Sawyer">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Poppy Ergo Jr","level":"1.4.2","depth":2,"next":{"title":"Sawyer","level":"1.4.3","depth":2,"path":"manipulation/sawyer/README.md","ref":"manipulation/sawyer/README.md","articles":[]},"previous":{"title":"E.DO","level":"1.4.1","depth":2,"path":"manipulation/edo/README.md","ref":"manipulation/edo/README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-search","search-plus","github","anchorjs","build","custom-favicon","language-picker","localized-footer","embed-pdf"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"language-picker":{"grid-columns":3},"github":{"url":"https://github.com/ros4pro/"},"localized-footer":{"filename":"FOOTER.md","hline":"true"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"build":{"args":[],"bin":"pandoc","format":"latex","opts":{},"output":"_book/main.tex","template":"_layouts/main.tex"},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"favicon":"img/favicon.ico","custom-favicon":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchorjs":{},"embed-pdf":{},"search-plus":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"ROS4PRO","language":"fr","gitbook":"*"},"file":{"path":"manipulation/ergo-jr/README.md","mtime":"2021-01-03T18:14:24.824Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-01-03T18:20:09.115Z"},"basePath":"../..","book":{"language":"fr"}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-anchorjs/anchor.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-anchorjs/anchor-style.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-language-picker/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

